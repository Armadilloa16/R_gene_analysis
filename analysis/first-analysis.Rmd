---
title: "first-analysis"
author: "Philipp Bayer"
date: "2020-09-17"
output: workflowr::wflow_html
editor_options:
  chunk_output_type: console
---

```{r setup}
library(tidyverse)
library(patchwork)
library(ggsci)
library(cowplot)
theme_set(theme_cowplot())

```
## Introduction


```{r}
npg_col = pal_npg("nrc")(9)
col_list <- c(`Wild-type`=npg_col[8],
   Landrace = npg_col[3],
  `Old cultivar`=npg_col[2],
  `Modern cultivar`=npg_col[4])

pav_table <- read_tsv('./data/soybean_pan_pav.matrix_gene.txt')
```

```{r}
pav_table
```

## NBS part

Let's pull the NBS genes from the table
```{r}
nbs <- read_tsv('./data/Lee.NBS.candidates.lst', col_names = c('Name', 'Class'))
nbs
# have to remove the .t1s 
nbs$Name <- gsub('.t1','', nbs$Name)
```

```{r}
nbs_pav_table <- pav_table %>% filter(Individual %in% nbs$Name)
nbs_pav_table
```

```{r}
names <- c()
percs <- c()

for (i in seq_along(nbs_pav_table)){
  if ( i == 1) next
  thisind <- colnames(nbs_pav_table)[i]
  pavs <- nbs_pav_table[[i]]
  perc <- sum(pavs) / length(pavs) * 100
  names <- c(names, thisind)
  percs <- c(percs, perc)
}
res_tibb <- new_tibble(list(names = names, percs = percs))
res_tibb
```

OK what do these presence percentages look like?
```{r}
ggplot(data=res_tibb, aes(x=percs)) + geom_histogram(bins=25) 
```

On average, `r mean(res_tibb$percs)`% of NBS genes are present in each individual.

Now let's join the table of presences to the four different types so we can group these numbers.

```{r}
groups <- read_csv('./data/Table_of_cultivar_groups.csv')
groups
joined_groups <- left_join(res_tibb, groups, by = c('names'='Data-storage-ID'))
```

```{r}
joined_groups$`Group in violin table` <- gsub('landrace', 'Landrace', joined_groups$`Group in violin table`)
joined_groups$`Group in violin table` <- gsub('Modern_cultivar', 'Modern cultivar', joined_groups$`Group in violin table`)
joined_groups$`Group in violin table` <- gsub('Old_cultivar', 'Old cultivar', joined_groups$`Group in violin table`)

joined_groups$`Group in violin table` <- factor(joined_groups$`Group in violin table`, levels=c(NA, 'Wild-type', 'Landrace', 'Old cultivar', 'Modern cultivar'))
```

```{r}
nbs_vio <- joined_groups %>% filter(`Group in violin table` != 'NA') %>% 
  ggplot(aes(y=percs, x=`Group in violin table`, fill=`Group in violin table`)) + 
  geom_violin() +
  scale_fill_manual(values=col_list)+
  guides(fill = FALSE) +
  ylim(c(87, 100))
```

## RLK part

Let's do the  same plot with RLKs


```{r}
rlk <- read_tsv('./data/Lee.RLK.candidates.lst', col_names = c('Name', 'Class', 'Subtype'))
rlk
# have to remove the .t1s 
rlk$Name <- gsub('.t1','', rlk$Name)
```

```{r}
rlk_pav_table <- pav_table %>% filter(Individual %in% rlk$Name)
rlk_pav_table
```

```{r}
names <- c()
percs <- c()

for (i in seq_along(rlk_pav_table)){
  if ( i == 1) next
  thisind <- colnames(rlk_pav_table)[i]
  pavs <- rlk_pav_table[[i]]
  perc <- sum(pavs) / length(pavs) * 100
  names <- c(names, thisind)
  percs <- c(percs, perc)
}
res_tibb <- new_tibble(list(names = names, percs = percs))
res_tibb
```

OK what do these presence percentages look like?
```{r}
ggplot(data=res_tibb, aes(x=percs)) + geom_histogram(bins=25) 
```

On average, `r mean(res_tibb$percs)`% of NBS genes are present in each individual.

Now let's join the table of presences to the four different types so we can group these numbers.

```{r}
groups <- read_csv('./data/Table_of_cultivar_groups.csv')
groups
joined_groups <- left_join(res_tibb, groups, by = c('names'='Data-storage-ID'))
```

```{r}
joined_groups$`Group in violin table` <- gsub('landrace', 'Landrace', joined_groups$`Group in violin table`)
joined_groups$`Group in violin table` <- gsub('Modern_cultivar', 'Modern cultivar', joined_groups$`Group in violin table`)
joined_groups$`Group in violin table` <- gsub('Old_cultivar', 'Old cultivar', joined_groups$`Group in violin table`)

joined_groups$`Group in violin table` <- factor(joined_groups$`Group in violin table`, levels=c(NA, 'Wild-type', 'Landrace', 'Old cultivar', 'Modern cultivar'))
```

```{r}
rlk_vio <- joined_groups %>% filter(`Group in violin table` != 'NA') %>% 
  ggplot(aes(y=percs, x=`Group in violin table`, fill=`Group in violin table`)) + 
  geom_violin() +
  scale_fill_manual(values=col_list) +
  guides(fill = FALSE) +
  ylim(c(87, 100))
```

## RLP part

And now with RLPs



```{r}
rlp <- read_tsv('./data/Lee.RLP.candidates.lst', col_names = c('Name', 'Class', 'Subtype'))
rlp
# have to remove the .t1s 
rlp$Name <- gsub('.t1','', rlp$Name)
```

```{r}
rlp_pav_table <- pav_table %>% filter(Individual %in% rlp$Name)
rlp_pav_table
```

```{r}
names <- c()
percs <- c()

for (i in seq_along(rlp_pav_table)){
  if ( i == 1) next
  thisind <- colnames(rlp_pav_table)[i]
  pavs <- rlp_pav_table[[i]]
  perc <- sum(pavs) / length(pavs) * 100
  names <- c(names, thisind)
  percs <- c(percs, perc)
}
res_tibb <- new_tibble(list(names = names, percs = percs))
res_tibb
```

OK what do these presence percentages look like?
```{r}
ggplot(data=res_tibb, aes(x=percs)) + geom_histogram(bins=25) 
```

On average, `r mean(res_tibb$percs)`% of NBS genes are present in each individual.

Now let's join the table of presences to the four different types so we can group these numbers.

```{r}
groups <- read_csv('./data/Table_of_cultivar_groups.csv')
groups
joined_groups <- left_join(res_tibb, groups, by = c('names'='Data-storage-ID'))
```

```{r}
joined_groups$`Group in violin table` <- gsub('landrace', 'Landrace', joined_groups$`Group in violin table`)
joined_groups$`Group in violin table` <- gsub('Modern_cultivar', 'Modern cultivar', joined_groups$`Group in violin table`)
joined_groups$`Group in violin table` <- gsub('Old_cultivar', 'Old cultivar', joined_groups$`Group in violin table`)

joined_groups$`Group in violin table` <- factor(joined_groups$`Group in violin table`, levels=c(NA, 'Wild-type', 'Landrace', 'Old cultivar', 'Modern cultivar'))
```

```{r}
rlp_vio <- joined_groups %>% filter(`Group in violin table` != 'NA') %>% 
  ggplot(aes(y=percs, x=`Group in violin table`, fill=`Group in violin table`)) + 
  geom_violin() +
  scale_fill_manual(values=col_list) +
  guides(fill = FALSE) +
  ylim(c(87, 100))
```

## Plotting together

```{r}
nbs_vio + rlk_vio + rlp_vio
```
